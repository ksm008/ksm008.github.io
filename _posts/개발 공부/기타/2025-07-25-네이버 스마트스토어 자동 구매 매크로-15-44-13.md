---
layout: post
title: 자바로 셀레니움을 사용해보자 (ft. 네이버 스마트스토어)
date: 2025-07-25 15:44:13 +0900
categories:
  - 개발 공부
  - 기타
tags:
---
# 다른 공부 하느라 패스...

최근 한 친구가 복숭아에 미쳐있다는 것을 알게 되었습니다. 그냥 미친 정도가 아닙니다. 개미친 또라이 복숭아 처돌이 그 자체입니다. 1년마다 복숭아를 사는데에만 1-200만원은 쓴다고 했으니 제정신이 아닌 놈이 확실합니다 (본인피셜 3-400까진 아니다 정정 요청이 들어와 수정함)

아무튼 이 친구가 복숭아를 구매하는 곳도 정말 여러 곳이였는데, 대부분 너무 유명해진 탓에 사람들이 몰려 금방 품절되는 곳들이였습니다. 매크로를 사볼 생각은 없냐고 물어봤지만 고민중이라고 하길래그럴바에는 생각을 바꿔보자고 했습니다.

> 매크로 안 살거면 직접 만들어보면 되는거 아니냐?

...근데 뭐 어떻게 하는거지? 셀레니움? XPATH? cssSelector? 이게 뭔데요... 프론트엔드 잘 몰라! 

낯선 단어들이 나와서 조금 공부를 진행해야 했습니다. 요즘 간단한 코드들은 GPT에게 부탁하면 알아서 잘 짜주지만 내가 코드를 이해하지 못하면 어디서 에러가 발생했는지, 뭐가 문제인지 정확하게 알 수가 없습니다. GPT도 정확하게 에러가 어디서 유발되는지 찾아내지 못하는 경우가 많습니다.

- 스마트스토어 구매 버튼을 누르고 일반결제를 선택하도록 코드를 짜놓은 적이 있었습니다. 그런데 일반결제를 누를 때 에러가 떠서 그걸 GPT에게 물어보니 일반결제 요소를 찾지 못해 발생하는 문제라고 하더군요. 그러더니 어떻게든 그 요소를 누르려고 별 짓을 다하는 코드를 짜주었습니다. 정작 문제는 페이지 로딩이 느려서 애초에 요소가 로딩조차 되지 않았던 것이였습니다. 그래서 1초 정도 지연을 주거나, WebDriverWait으로 해결이 가능했습니다. GPT는 사람이 아니다보니 뭐가 문제인지 **코드만** 보고 알아내기 때문에 가끔 이런 기본적인 에러도 돌아가는 경우가 정말 많습니다. 

그래서 그냥 셀레니움을 어떻게 쓰는지부터 차근차근 공부했습니다. 

... 이게 점점 공부하다보니 자바 가지고만은 안되고 자바스크립트가 더 중요하네요. 대부분의 사이트에서는 click(), sendkeys() 같은 메소드들은 봇으로 간주하기 때문에 자바스크립트로 클릭하거나 문자열을 집어넣는게 더 좋습니다. 근데 자바스크립트는 제가 미숙해서 조금 더 공부하고 올려보겠습니다.
## 셀레니움 설치

언어는 자바, IDE는 IntelliJ를 사용했고 gradle에 셀레니움을 추가해 의존성 주입을 해주었습니다.

```gradle
dependencies {
	...
	implementation 'org.seleniumhq.selenium:selenium-java:4.14.0'
	...
}
```

## 셀레니움의 동작 단계
셀레니움의 동작 단계는 크게 3단계로 나뉩니다.

 1. 웹드라이버 불러오기 (크롬드라이버)
 2. 웹요소를 찾아 불러오기
 3. 그 요소에 특정 메소드를 실행 (클릭, 문자열 삽입 등)

```java
import org.openqa.selenium.By;  
import org.openqa.selenium.WebDriver;  
import org.openqa.selenium.WebElement;  
import org.openqa.selenium.chrome.ChromeDriver;  
import org.openqa.selenium.support.ui.ExpectedConditions;  
import org.openqa.selenium.support.ui.WebDriverWait;  
  
import java.time.Duration;  
  
public class SeleniumTest {  
    public static void main(String[] args) {  
        // 시스템 경로 설정  
        System.setProperty("webdriver.chrome.driver", "C:/chromedriver/chromedriver.exe");  
  
        // 웹 드라이버 불러오기  
        WebDriver driver = new ChromeDriver();  
  
        // 웹 드라이버 대기 불러오기  
        // Duration.ofSeconds(N)은 해당 요소를 찾을 때까지 N초 대기하는 것을 의미
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(30));  
  
        // 웹 사이트 이동  
        driver.get("https://www.naver.com");  
  
        // 검색 바 찾기  
        WebElement searchBar = wait.until(ExpectedConditions.visibilityOfElementLocated(  
                By.id("query")  
        ));  
  
        // 검색 바에 문자열 입력   
searchBar.sendKeys("네이버 주식");  
  
        // 검색 버튼 찾기  
        WebElement searchBtn = wait.until(ExpectedConditions.visibilityOfElementLocated(  
                By.xpath("//*[@id=\"sform\"]/fieldset/button")  
        ));  
  
        // 검색 버튼 클릭  
        searchBtn.click();  
    }  
}
```

간단한 예제 하나를 가져왔습니다. 네이버에 들어가 검색바를 찾고 '네이버 주식'을 입력, 그리고 검색 버튼을 누르는 간단한 코드입니다.

검색바나 버튼 등 요소를 찾는데에는 많은 방법이 있으므로 아래에 간락하게 적어보겠습니다.

## 웹 요소 찾는 방법

요소를 찾는 방법에는 여러가지가 있습니다. 

|메소드|설명|예시|
|---|---|---|
|`By.id("id값")`|`id` 속성으로 찾음|`By.id("username")`|
|`By.name("name값")`|`name` 속성으로 찾음|`By.name("user_email")`|
|`By.className("클래스명")`|`class` 속성으로 찾음. 공백 없이 하나만 가능|`By.className("btn-primary")`|
|`By.tagName("태그명")`|`div`, `a`, `button` 등 태그로 찾음|`By.tagName("input")`|
|`By.linkText("링크 전체 텍스트")`|`<a>` 태그의 텍스트 전체로 찾음|`By.linkText("회원가입")`|
|`By.partialLinkText("일부 텍스트")`|`<a>` 태그의 텍스트 일부로 찾음|`By.partialLinkText("가입")`|
|`By.cssSelector("CSS 선택자")`|CSS 스타일 문법으로 요소 찾기|`By.cssSelector("div.box > input[type='text']")`|
|`By.xpath("XPath 경로")`|XPath 경로로 찾기|`By.xpath("//input[@type='password']")`|

id가 존재한다면 id로 찾는게 가장 편합니다. 겹칠 일이 없기 때문이죠. 하지만 id가 존재하지 않는 경우도 많고, 클래스는 이름이 겹치거나 매번 접속할 때마다 암호화된 문자열이 바뀌는 경우도 존재합니다. 때문에 요소의 정확한 위치를 기반으로 하는 **XPath**나 CSS 스타일 문법으로 요소를 찾는 **cssSelector**를 자주 사용하는 편입니다. 특히 cssSelector는 **정규식**을 사용할 수 있기 때문에 편한 부분도 있습니다. XPath는 페이지의 구조가 잘 바뀌지 않는다면 편하지만 만약 관리자가 구조를 바꾸게 되면 사용하지 못한다는 단점이 있습니다. 또한 F12를 누르면 나오는 개발자 도구를 사용하여 쉽게 추출할 수 있습니다.

## 특정 메소드 실행

인터넷 브라우저에서 마우스나 키보드로 할 수 있는 작업은 클릭과 문자 타이핑일 것입니다. 요소를 선택한 후 클릭은 `click()`, 문자 타이핑은 `sendkeys()` 메소드로 할 수 있습니다. 대부분의 사이트는 해당 메소드로 해결이 되지만, 자바스크립트로 클릭과 문자 입력을 받는 사이트들은 불가능합니다. 왜냐면 클릭을 하려면 해당 요소가 a태그와 같이 클릭이 가능한 태그여야 하는데, 자바스크립트로 클릭을 하게 만들 경우 div나 label 태그에 클릭을 하게 만들기 때문입니다. 그러므로 해당 태그들에게 click() 메소드 요청을 하여도 클릭을 할 수 없는 요소라는 에러를 반환하게 됩니다.

### 클릭 요청 - 자바스크립트

자바스크립트로 해당 요소를 클릭하라는 스크립트를 실행시켜야 합니다.

```java
WebElement commentButton = wait.until(ExpectedConditions.visibilityOfElementLocated(  
        By.id("Comi" + postId)  
));

// commentButton을 클릭하도록 설정
((JavascriptExecutor) driver).executeScript("arguments[0].click();", commentButton);
```

### 문자 입력 요청 - 자바스크립트
