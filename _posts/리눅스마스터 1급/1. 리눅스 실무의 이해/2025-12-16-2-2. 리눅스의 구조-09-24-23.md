---
layout: post
title: 2-2. 리눅스의 구조
date: 2025-12-16 09:24:23 +0900
categories:
  - 리눅스마스터 1급
  - 2. 리눅스 시스템의 이해
published: true
math: true
tags:
---
## 1. 부트 매니저
###  1. 부트 매니저의 개요

1. 부트 매니저의 정의
	- 부트 매니저는 하드에 위치한 운영체제를 램으로 로드하기 위한 프로그램. 부트 로더라고도 함
2. 부트 매니저의 동작 원리
	- 시스템이 켜지면 바이오스는 디스크의 0번 섹터 (첫 섹터)인 부트 섹터에서 512바이트의 MBR (Master Boot Record)을 읽는다. MBR은 크기가 제한되기 때문에 IPL(Initial Program Loader)이라 불리는 부트로더의 일부가 먼저 실행됨. IPL은 파티션 테이블을 검사하여 부트로더의 나머지 코드의 위치를 알아내 실행한다.
	- 대표적인 부트 매니저 프로그램으로는 LILO(LInux LOader), GRUB(Grand Unified BootLoader), GRUB2가 있다.

## 2. 주요 디렉터리 구조
### 1. 리눅스 파일 시스템 표준 (FHS: File sysyem Hierarchy Standard)
1. 리눅스 파일 시스템 표준은 BSD 파일 시스템 계층 구조 기반의 리눅스 디렉터리 구조 표준이다. 이 표준은 리눅스 재단이 유지 및 관리를 수행하고 있고 리눅스 재단은 HP, 래드햇, IBM, Dell과 같은 주요 소프트웨어 및 하드웨어 공급 업체들로 구성되어 있다.
2. 최신 버전은 2004년 1월 29일에 발표된 2.3

### 2. 리눅스의 주요 디렉터리

| 디렉터리          | 설명                                                                                                                                                |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| /             | 최상위 디렉터리                                                                                                                                          |
| /bin/         | 모든 사용자가 사용할 수 있는 주요 명령어들인 ls, cp, mkdir, mv, rm, cat, tar등이 위치해있다.                                                                                |
| /boot/        | 커널 파일이나 initrd등 부팅이 필요한 파일이 위치하는 디렉터리. 부트 로더인 grub 관련 파일도 이 디렉터리 이하에 위치한다.                                                                        |
| /dev/         | 하드, CPU, 네트워크, 입출력장치 등 디바이스 파일이 존재하는 디렉터리.                                                                                                        |
| /etc/         | 보통 Editable Text Configuration이나 Extended Tool chest와 같은 약어로 해석됨. 시스템 환경설정 파일과 시스템 초기화 시 수행되는 여러 스크립트 파일이 위치함. init 프로세스가 수행하는 환경설정 파일도 이 위치에 있음. |
| /home/        | 로그인한 사용자의 파일, 개인설정, 기타 등을 포함하는 사용자 전용 홈 디렉터리. 이 디렉터리 이하에 각 사용자 계정으로 폴더가 생성되고 사용자별 데이터가 저장됨.                                                       |
| /lib/         | 시스템에 설치되어 있는 각종 라이브러리가 저장되어 있는 디렉터리. 특히 /lib/modules/에는 설치된 커널의 모듈이 위치.                                                                           |
| /media/       | CD-ROM이나 이동식 디스크가 시스템에 마운트시 사용.                                                                                                                   |
| /mnt/         | 다양한 디바이스가 마운트할 때 사용하는 임시 디렉터리.                                                                                                                    |
| /opt/         | 추가 어플리케이션 소프트웨어 패키지                                                                                                                               |
| /proc/        | 메모리에 존재하는 모든 프로세스들이 파일 형태로 매핑됨. 디스크상에 실재 존재하는 것이 아닌 가상 파일 시스템으로 구성되어있음. 이 디렉터리를 통해 프로세스의 상태 정보, 하드웨어 정보, 기타 시스템 정보를 확인할 수 있다.                     |
| /root/        | 루트 사용자의 홈 디렉터리.                                                                                                                                   |
| /sbin/        | 시스템 종료 명령어인 shutdown, 네트워크 인터페이스 관련 명령어인 ifconfig, 시스테 점검과 복구 등 root가 사용하는 시스템 관리 명령어가 포함되어있다. sbin은 'System Binary'의 약자.                         |
| /tmp/         | /var/tmp/와 같은 공용 디렉토리로서 퍼미션은 1777, sticky bit가 설정되어있다. 각종 프로그램들이 임시 파일을 생성하는 디렉터리.                                                                |
| /usr/         | 사용자들이 사용하기 위해 설치한 주요 명령어들이 위치.                                                                                                                    |
| /usr/bin/     | 대부분의 사용자 명령어를 포함. Perl과 같은 명령어도 이 곳에 위치.                                                                                                          |
| /usr/include/ | C, C++ 등 프로그래밍 언어가 사용하는 헤더파일이 위치.                                                                                                                 |
| /usr/lib/     | /usr/bin/과 /usr/sbin/에 있는 바이너리에 링크하기 위한 라이브러리.                                                                                                    |
| /usr/sbin/    | 주로 시스템 관리자가 사용하는 명령들이나 상대적으로 중요하지 않은 명령어들이 위치.                                                                                                    |
| /var/         | 로그, 스풀 파일 등 임시로 생성되거나 상황에 따라 생성, 삭제될 수 있는 데이터가 보관됨. 로그 파일은 /var/log, 메일은 /var/spool/mail, cron의 설정 파일은 /car/spool/cron에 위치함.                      |
| /sys/         | 핫 플러그 장치를 위한 sysfs 가상 파일 시스템을 통해 장치 정보를 제공한다. 프로세스를 위한 정보를 제공하는 /proc와 유사한 방식.                                                                    |
| /run/         | 부팅 이후 시스템의 실행중인 프로세스 또는 로그인한 사용자와 같은 런타임 데이터를 포함하는 디렉터리. /var/run에 대한 심볼릭 링크.                                                                     |

과거 FHS를 만들 당시에는 하드 디스크의 용량이 작아 루트 파티션에 모든 시스템 명령어를 넣어둘 수 없었다. 때문에 루트의 sbin 디렉터리에는 부팅이나 복구, 디스크 검사와 같은 필수적인 시스템 명령어만 넣어두고 중요도가 낮은 시스템 명령어들은 /usr/sbin/ 디렉터리에 보관했다. 

하지만 시대가 지나면서 디스크 용량이 커지며 루트 파티션과 /usr 파티션을 물리적으로 쪼갤 필요가 없어지자, 관리를 편하게 하기 위해 합쳐버렸다. 이를 **Usr Merge**라고 부른다. 때문에 Rocky Linux 8.8의 경우 /bin, /lib, /sbin 들은 디렉터리가 아닌 /usr 디렉터리 안 각 디렉터리들의 심볼릭 링크이다.

## 3. 부팅과 셧다운
### 1. 부팅의 개요
1. 부팅이란 컴퓨터의 전원이 켜진 후 사용자가 시스템을 사용할 수 있도록 운영체제를 기동하는 절차 혹은 과정. 
2. 부팅을 위해서는 바이오스가 MBR로부터 부트로더를 실행한다. 부트로더는 지정된 위치에서 커널을 메모리에서 읽어 들인 후 초기화 프로세스를 실행한다. 특히 리눅스의 경우 사용자가 지정한 실행 레벨에 따라 지정된 스크립트를 수행하여 운영체제의 나머지 초기화를 완료한다.

### 2. 부팅의 상세 절차
#### 1. 시스템 시작 및 하드웨어 초기화
- 바이오스 및 시스템 시작 단계.
- 컴퓨터의 메인보드의 롬 영역에 저장된 프로그램으로 시스템을 켜면 가장 먼저 실행됨.
- 컴퓨터 하드웨어 인식과 각 장치들의 사용 준비를 위한 준비를 수행하는 등 POST(Power On Self Test) 기능을 수행.

#### 2. 1단계 부트로더
- 하드디스크의 0번 섹터를 MBR이라고 부르며 운영체제 로드를 위한 1단계 부트로더인 boot.img가 위치한다.
- 다음 단계인 2단계 부트로더는 파일 시스템 상에 위치한다. 하지만 0번 섹터는 512바이트에 불과하기 때문에 1단계 부트로더가 파일 시스ㅔㅁ을 해석할 수 있는 기능을 담기에는 공간이 부족. 이에 2단계 부트로더를 윟 파일 시스템을 해석할 수 있는 기능을 가진 중간 단계의 1.5 단계 부트로더(core.img)가 필요하며, boot.img는 core.img로 점프하는 역할까지만 수행한다.
- 1.5 단계 부트로더는 0번 섹터 이후 첫 파티션 이전의 공간에 위치한다. 첫 파티션은 63번 섹터에 위치하므로 약 62개의 섹터 공간 (약 30키로바이트)에 걸쳐 1.5단계 부트로더가 위치할 수 있다. 이 공간을 활용해 ext, fat, NTFS 같은 파일 시스템 드라이버를 포함할 수 있다.

#### 3. 2단계 부트로더
- 2단계 부트로더는 파일 시스템 상에 위치한다. (/boot/grub2/)
- GRUB legacy 및 GRUB2는 grub.conf(grub.cfg)의 설정에 따라 선택할 수 있는 운영체제 목록을 표시한다. 
- 사용자가 운영체제를 선택하면 해당 운영체제를 위한 커널을 메모리에 로드하고 해당 커널에게 제어권을 전달한다.

#### 4. 커널
- 하드웨어와 소프트웨어를 관장하는 핵심 모듈.
- 한번 메모리에 로드되면 시스템이 리부팅하거나 종료할 때까지 상주.
- GRUB으로부터 제어권을 이어받은 커널은 /sbin/init의 프로그램을 실행한다. 리눅스 배포판에 따라 차이가 있는데, 레드햇 계열 6에서는 init 프로세스를 그대로 실행한다. 래드햇 계열 7 이후로는 심볼릭 링크되어있는 systemd 프로세스를 실행한다.

#### 5. INIT 프로세스
- 부팅을 위해 필요한 초기화 작업을 실제로 수행.
- 가장 먼저 시스템의 프로퍼티, 하드웨어, 디스플레이, SELinux, 커널 모듈, 파일 시스템 마운트 등을 체크하기 위해 /etc/rc.d/rc.sysinit 스크립트를 수행한다.
- /etc/inittab 파일을 읽어 실행 레벨을 확인하고 그에 맞는 스크립트를 실행한다. 실행 레벨이 5인 경우, /etc/rc5.d 디렉터리에 위치한 스크립트가 실행된다.
- 스크립트가 모두 수행되고 나면 /etc/rc.local에 정의된 프로세스를 마지막으로 실행한다.

| 레벨  | 설명                                            |
| --- | --------------------------------------------- |
| 0   | 시스템의 종료를 의미. 실행 레벨을 0으로 설정하면 시스템이 종료됨.        |
| 1   | 단일 사용자 모드 또는 시스템 복원 모드라고 함. 루트 권한 셸을 얻을 수 있음. |
| 2   | 다중 사용자 모드이다. 네트워크 기능을 제공하지 않는 텍스트 기반 유저 모드.   |
| 3   | 네트워크 기능을 제공하는 다중 사용자 모드.                      |
| 4   | 현재 사용되고 있지 않은 모드.                             |
| 5   | X 윈도우를 사용하는 다중 사용자 모드.                        |
| 6   | 시스템을 재부팅할 때 사용하는 실행 레벨.                       |
#### 6. systemd
- systemd는 유닛이라는 단위로 시스템 및 서비스를 제어함.
- 기존에는 /sbin/init 경로에 위치하는 System V 계열의 INIT 프로세스가 PID 1을 가졌지만, 래드헷 계열 7부터는 심볼릭 링크가 걸려있는 /usr/lib/system/system가 그 역할을 수행한다.
