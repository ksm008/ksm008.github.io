# 챕터 12: 네트워크 프로그래밍 (소켓 통신)

## 개요
WinAPI를 사용하면 소켓을 통해 네트워크 통신을 구현할 수 있습니다. 이 챕터에서는 소켓 통신의 기본 개념을 배우고, 간단한 클라이언트-서버 구조를 구현하는 방법을 학습합니다.

### 1. 소켓 통신 기초
소켓은 네트워크를 통해 데이터를 주고받기 위해 필요한 인터페이스입니다. WinAPI에서 제공하는 `winsock2.h` 라이브러리를 통해 소켓을 생성하고 데이터를 전송할 수 있습니다.

### 2. 윈속 초기화하기
WinAPI에서 소켓을 사용하려면 먼저 `WSAStartup` 함수를 호출하여 윈속을 초기화해야 합니다.

```c
WSADATA wsaData;
if (WSAStartup(MAKEWORD(2, 2), &wsaData) != 0) {
    printf("Winsock 초기화 실패\n");
    return 1;
}
```

### 3. 서버 소켓 만들기
서버 소켓을 생성하고 클라이언트 연결을 기다리도록 설정합니다.

```c
SOCKET serverSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
if (serverSocket == INVALID_SOCKET) {
    printf("소켓 생성 실패\n");
    WSACleanup();
    return 1;
}

// 서버 주소 설정
struct sockaddr_in serverAddr;
serverAddr.sin_family = AF_INET;
serverAddr.sin_addr.s_addr = INADDR_ANY;  // 모든 IP 주소에서 연결 허용
serverAddr.sin_port = htons(8080);        // 포트 번호 8080

// 바인딩
bind(serverSocket, (struct sockaddr*)&serverAddr, sizeof(serverAddr));

// 연결 대기
listen(serverSocket, SOMAXCONN);
```

### 4. 클라이언트 소켓 만들기
클라이언트 소켓을 생성하고 서버에 연결을 시도합니다.

```c
SOCKET clientSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);

// 서버 주소 설정
struct sockaddr_in serverAddr;
serverAddr.sin_family = AF_INET;
serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1"); // 서버 IP 주소
serverAddr.sin_port = htons(8080);                    // 서버 포트 번호

// 서버에 연결
connect(clientSocket, (struct sockaddr*)&serverAddr, sizeof(serverAddr));
```

### 5. 데이터 송수신
연결된 소켓을 통해 데이터를 주고받을 수 있습니다. `send`와 `recv` 함수를 사용하여 데이터를 전송하고 수신합니다.

```c
// 데이터 전송 (서버/클라이언트 공통)
char sendData[] = "Hello, World!";
send(clientSocket, sendData, strlen(sendData), 0);

// 데이터 수신
char recvData[1024];
int recvSize = recv(clientSocket, recvData, sizeof(recvData), 0);
recvData[recvSize] = '\0';  // 문자열 끝 처리
printf("받은 데이터: %s\n", recvData);
```

### 6. 연결 종료 및 윈속 정리
통신이 완료되면 소켓을 닫고 `WSACleanup`을 호출하여 윈속을 정리합니다.

```c
closesocket(clientSocket);
closesocket(serverSocket);
WSACleanup();
```

### 실습 예제: 간단한 채팅 애플리케이션 구현하기
서버와 클라이언트가 문자열을 주고받는 간단한 채팅 애플리케이션을 만들어 봅시다. 서버는 클라이언트의 연결을 기다리고, 클라이언트는 서버에 연결하여 메시지를 주고받습니다.

---

소켓 통신을 사용하면 WinAPI로 네트워크 기반 애플리케이션을 만들 수 있습니다. 이 기초를 바탕으로 파일 전송, 실시간 메시지 송수신 등 다양한 네트워크 애플리케이션을 구현할 수 있습니다.
